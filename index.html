<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Peso Diario</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Estilos base para móviles -->
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.2s ease-out; }
        .animate-scaleUp { animation: scaleUp 0.2s ease-out; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signInAnonymously 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            deleteDoc, 
            updateDoc, 
            doc, 
            onSnapshot, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- CONFIGURACIÓN REAL PARA GITHUB PAGES ---
        const firebaseConfig = {
            apiKey: "AIzaSyAfn1RVDfrbNMxVRgOcgHu-8QMmGAhugik",
            authDomain: "comidassaludables.firebaseapp.com",
            projectId: "comidassaludables",
            storageBucket: "comidassaludables.firebasestorage.app",
            messagingSenderId: "528526969296",
            appId: "1:528526969296:web:00786114cf5a0f28ab91d5",
            measurementId: "G-7D62CLX8N0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Alias para createElement
        const h = React.createElement;
        
        // Iconos
        const Icons = {
            Scale: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" }), h("path", { d: "m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" }), h("path", { d: "M7 21h10" }), h("path", { d: "M12 3v18" }), h("path", { d: "M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2" })),
            Calendar: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("rect", { width: "18", height: "18", x: "3", y: "4", rx: "2", ry: "2" }), h("line", { x1: "16", x2: "16", y1: "2", y2: "6" }), h("line", { x1: "8", x2: "8", y1: "2", y2: "6" }), h("line", { x1: "3", x2: "21", y1: "10", y2: "10" })),
            Activity: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "M22 12h-4l-3 9L9 3l-3 9H2" })),
            Plus: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "M5 12h14" }), h("path", { d: "M12 5v14" })),
            Minus: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "M5 12h14" })),
            Trash2: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "M3 6h18" }), h("path", { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" }), h("path", { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" }), h("line", { x1: "10", x2: "10", y1: "11", y2: "17" }), h("line", { x1: "14", x2: "14", y1: "11", y2: "17" })),
            Edit2: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" })),
            X: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("path", { d: "M18 6 6 18" }), h("path", { d: "m6 6 12 12" })),
            TrendingUp: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("polyline", { points: "22 7 13.5 15.5 8.5 10.5 2 17" }), h("polyline", { points: "16 7 22 7 22 13" })),
            TrendingDown: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("polyline", { points: "22 17 13.5 8.5 8.5 13.5 2 7" }), h("polyline", { points: "16 17 22 17 22 11" })),
            AlertCircle: (props) => h("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, h("circle", { cx: "12", cy: "12", r: "10" }), h("line", { x1: "12", x2: "12", y1: "8", y2: "12" }), h("line", { x1: "12", x2: "12.01", y1: "16", y2: "16" }))
        };

        function App() {
            const [user, setUser] = React.useState(null);
            const [logs, setLogs] = React.useState([]);
            const [permissionError, setPermissionError] = React.useState(false); 
            
            const [weightInput, setWeightInput] = React.useState('');
            const [dateInput, setDateInput] = React.useState(new Date().toISOString().split('T')[0]);
            const [isSubmitting, setIsSubmitting] = React.useState(false);
            
            const [editingId, setEditingId] = React.useState(null);
            const [deleteModal, setDeleteModal] = React.useState({ show: false, id: null });

            const [selectedProfile, setSelectedProfile] = React.useState('Lucas Abraham');
            const [isAddingProfile, setIsAddingProfile] = React.useState(false);
            const [newProfileName, setNewProfileName] = React.useState('');

            React.useEffect(() => {
                signInAnonymously(auth).catch((error) => console.error("Error Auth:", error));
                return onAuthStateChanged(auth, setUser);
            }, []);

            React.useEffect(() => {
                if (!user) return;
                setPermissionError(false);
                
                // Usamos una colección anidada por usuario para mayor seguridad y orden
                const logsCollection = collection(db, 'users', user.uid, 'registros_peso');
                
                const unsubscribe = onSnapshot(logsCollection, (snapshot) => {
                    const logsData = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setLogs(logsData);
                }, (error) => {
                    console.error("Error Firestore:", error);
                    if(error.code === 'permission-denied') setPermissionError(true);
                });
                return () => unsubscribe();
            }, [user]);

            const availableProfiles = React.useMemo(() => {
                const profiles = new Set(['Lucas Abraham', 'Carolina Sosa']); 
                logs.forEach(log => { if (log.profile) profiles.add(log.profile); });
                if (selectedProfile) profiles.add(selectedProfile);
                return Array.from(profiles).sort();
            }, [logs, selectedProfile]);

            const filteredSortedLogs = React.useMemo(() => {
                return logs
                    .filter(log => (log.profile) === selectedProfile)
                    .sort((a, b) => {
                        if (a.date < b.date) return 1;
                        if (a.date > b.date) return -1;
                        return 0;
                    });
            }, [logs, selectedProfile]);

            const getTheme = (profile) => {
                if (profile === 'Lucas Abraham') {
                    return {
                        gradientText: 'from-blue-600 to-emerald-500', 
                        gradientBg: 'from-blue-500 to-emerald-500',
                        bgPage: 'bg-gradient-to-br from-blue-50 to-emerald-50',
                        buttonShadow: 'shadow-emerald-500/30',
                        iconColor: 'text-emerald-500',
                        accentBorder: 'border-emerald-200'
                    };
                } else if (profile === 'Carolina Sosa') {
                    return {
                        gradientText: 'from-pink-500 to-orange-400', 
                        gradientBg: 'from-pink-500 to-orange-400',
                        bgPage: 'bg-gradient-to-br from-pink-50 to-orange-50',
                        buttonShadow: 'shadow-pink-500/30',
                        iconColor: 'text-pink-500',
                        accentBorder: 'border-pink-200'
                    };
                }
                return {
                    gradientText: 'from-slate-600 to-slate-800',
                    gradientBg: 'from-slate-600 to-slate-800',
                    bgPage: 'bg-slate-50',
                    buttonShadow: 'shadow-slate-500/30',
                    iconColor: 'text-slate-500',
                    accentBorder: 'border-slate-200'
                };
            };

            const currentTheme = getTheme(selectedProfile);

            const handleSaveLog = async (e) => {
                e.preventDefault();
                if (!user) {
                    alert("Espera un momento, iniciando sesión...");
                    return;
                }
                if (!weightInput || !dateInput) return;

                setIsSubmitting(true);
                try {
                    const collectionRef = collection(db, 'users', user.uid, 'registros_peso');
                    if (editingId) {
                        const logRef = doc(db, 'users', user.uid, 'registros_peso', editingId);
                        await updateDoc(logRef, {
                            weight: parseFloat(weightInput),
                            date: dateInput,
                            profile: selectedProfile, 
                            updatedAt: serverTimestamp()
                        });
                        setEditingId(null);
                    } else {
                        await addDoc(collectionRef, {
                            weight: parseFloat(weightInput),
                            date: dateInput,
                            profile: selectedProfile,
                            createdAt: serverTimestamp()
                        });
                    }
                    setWeightInput(''); 
                } catch (error) {
                    console.error("Error al guardar:", error);
                    if(error.code === 'permission-denied') setPermissionError(true);
                    else alert("Error al guardar: " + error.message);
                } finally {
                    setIsSubmitting(false);
                }
            };

            const startEditing = (log) => {
                setWeightInput(log.weight);
                setDateInput(log.date);
                setEditingId(log.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const cancelEditing = () => {
                setEditingId(null);
                setWeightInput('');
                setDateInput(new Date().toISOString().split('T')[0]);
            };

            const confirmDelete = (id) => {
                setDeleteModal({ show: true, id });
            };

            const executeDelete = async () => {
                if (!deleteModal.id || !user) return;
                try {
                    await deleteDoc(doc(db, 'users', user.uid, 'registros_peso', deleteModal.id));
                    if (editingId === deleteModal.id) cancelEditing();
                } catch (error) {
                    console.error("Error al eliminar:", error);
                    if(error.code === 'permission-denied') setPermissionError(true);
                } finally {
                    setDeleteModal({ show: false, id: null });
                }
            };

            const getDifference = (currentIndex, currentWeight) => {
                if (currentIndex === filteredSortedLogs.length - 1) return null; 
                const previousLog = filteredSortedLogs[currentIndex + 1];
                return currentWeight - previousLog.weight;
            };

            const formatDate = (dateString) => {
                if (!dateString) return '';
                const [year, month, day] = dateString.split('-').map(Number);
                const date = new Date(year, month - 1, day); 
                return date.toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' });
            };

            const handleCreateProfile = (e) => {
                e.preventDefault();
                if (newProfileName.trim()) {
                    setSelectedProfile(newProfileName.trim());
                    setNewProfileName('');
                    setIsAddingProfile(false);
                }
            };

            // --- Componentes UI ---

            const renderErrorBanner = permissionError ? h("div", { className: "fixed top-0 left-0 right-0 z-[60] p-4 bg-red-500 text-white shadow-xl animate-fadeIn" },
                h("div", { className: "max-w-md mx-auto flex items-start gap-3" },
                    h(Icons.AlertCircle, { className: "w-6 h-6 shrink-0 mt-0.5" }),
                    h("div", null,
                        h("h3", { className: "font-bold text-lg" }, "Permiso Denegado"),
                        h("p", { className: "text-sm mt-1 opacity-90" }, "Las reglas de Firebase están bloqueando el acceso. En Firebase Console > Firestore Database > Reglas, cambia 'false' por 'if request.auth != null;'"),
                        h("button", { 
                            onClick: () => setPermissionError(false),
                            className: "mt-3 text-xs bg-white/20 hover:bg-white/30 px-3 py-1 rounded text-white font-bold transition-colors"
                        }, "Cerrar")
                    )
                )
            ) : null;

            const renderModal = deleteModal.show ? h("div", { className: "fixed inset-0 z-50 flex items-center justify-center p-4" },
                h("div", { className: "absolute inset-0 bg-black/40 backdrop-blur-sm animate-fadeIn", onClick: () => setDeleteModal({ show: false, id: null }) }),
                h("div", { className: "bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 relative z-10 animate-scaleUp" },
                    h("h3", { className: "text-lg font-bold text-slate-800 mb-2" }, "¿Estás seguro?"),
                    h("p", { className: "text-slate-500 mb-6" }, "Esta acción eliminará el registro permanentemente."),
                    h("div", { className: "flex gap-3 justify-end" },
                        h("button", { 
                            onClick: () => setDeleteModal({ show: false, id: null }),
                            className: "px-4 py-2 rounded-xl text-slate-500 font-semibold hover:bg-slate-100 transition-colors"
                        }, "Cancelar"),
                        h("button", { 
                            onClick: executeDelete,
                            className: "px-4 py-2 rounded-xl bg-rose-500 text-white font-semibold hover:bg-rose-600 shadow-lg shadow-rose-500/20 transition-all active:scale-95"
                        }, "Eliminar")
                    )
                )
            ) : null;

            const renderHeader = h("header", { className: "w-full max-w-lg mb-6 text-center relative z-10" },
                h("div", { className: `inline-flex items-center justify-center p-3 sm:p-4 bg-gradient-to-tr ${currentTheme.gradientBg} rounded-2xl shadow-xl mb-3 transform rotate-3 hover:rotate-0 transition-all duration-500` },
                    h(Icons.Scale, { className: "w-8 h-8 sm:w-10 sm:h-10 text-white" })
                ),
                h("h1", { className: `text-3xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r ${currentTheme.gradientText} tracking-tight mb-1 transition-all duration-500` }, "Control de Peso")
            );

            const renderProfileSelector = h("div", { className: "w-full max-w-lg mb-6" },
                h("div", { className: "flex flex-wrap gap-2 justify-center items-center" },
                    availableProfiles.map(profile => {
                        const isSelected = selectedProfile === profile;
                        const profileTheme = getTheme(profile);
                        return h("button", {
                            key: profile,
                            onClick: () => { setSelectedProfile(profile); cancelEditing(); },
                            className: `px-4 py-2 sm:px-6 sm:py-2 rounded-full text-sm sm:text-lg font-bold transition-all shadow-sm border ${isSelected ? `bg-gradient-to-r ${profileTheme.gradientBg} text-white shadow-lg scale-105 border-transparent` : 'bg-white text-slate-500 hover:bg-slate-50 border-slate-200'}`
                        }, profile);
                    }),
                    !isAddingProfile ? 
                        h("button", { 
                            onClick: () => setIsAddingProfile(true),
                            className: "p-2 rounded-full bg-white border border-slate-200 text-slate-400 hover:bg-slate-50 transition-colors shadow-sm active:scale-95",
                            title: "Agregar persona"
                        }, h(Icons.Plus, { className: "w-5 h-5" })) 
                    :
                        h("form", { onSubmit: handleCreateProfile, className: "flex items-center gap-2 bg-white p-1 pl-3 rounded-full shadow-md animate-in fade-in zoom-in border border-slate-200" },
                            h("input", { 
                                autoFocus: true,
                                type: "text", 
                                placeholder: "Nombre...", 
                                className: "w-24 outline-none text-sm font-semibold text-slate-700 bg-transparent",
                                value: newProfileName,
                                onChange: (e) => setNewProfileName(e.target.value)
                            }),
                            h("button", { type: "submit", className: "p-1.5 rounded-full text-white bg-slate-800" }, h(Icons.Plus, { className: "w-4 h-4" })),
                            h("button", { type: "button", onClick: () => setIsAddingProfile(false), className: "p-1.5 text-slate-400 hover:text-red-400" }, h(Icons.Minus, { className: "w-4 h-4" }))
                        )
                )
            );

            const saveButtonContent = isSubmitting ? 'Guardando...' : (editingId ? 
                h(React.Fragment, null, h(Icons.Edit2, { className: "w-5 h-5" }), " Actualizar Registro") : 
                h(React.Fragment, null, h(Icons.Plus, { className: "w-6 h-6" }), " Guardar Registro"));

            const renderForm = h("div", { className: `w-full max-w-lg bg-white/90 backdrop-blur-md rounded-3xl shadow-xl border ${editingId ? 'border-amber-300 ring-2 ring-amber-100' : 'border-white/50'} p-5 sm:p-6 mb-8 transition-all duration-300` },
                h("div", { className: "flex justify-between items-center mb-4" },
                    h("div", { className: "text-left" },
                        h("span", { className: "text-xs font-bold text-slate-400 uppercase tracking-widest block" }, editingId ? 'Editando registro de:' : 'Nuevo registro para:'),
                        h("div", { className: `text-lg font-black text-transparent bg-clip-text bg-gradient-to-r ${currentTheme.gradientText}` }, selectedProfile)
                    ),
                    editingId ? h("button", { 
                        onClick: cancelEditing,
                        className: "text-xs font-bold text-slate-400 bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-full flex items-center gap-1 transition-colors"
                    }, h(Icons.X, { className: "w-3 h-3" }), " Cancelar") : null
                ),
                h("form", { onSubmit: handleSaveLog, className: "flex flex-col gap-4" },
                    h("div", { className: "flex gap-3" },
                        h("div", { className: "flex-1" },
                            h("label", { className: "block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-1" }, "Fecha"),
                            h("div", { className: "relative group" },
                                h("div", { className: `absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 transition-colors ${currentTheme.iconColor}` }, h(Icons.Calendar, null)),
                                h("input", { 
                                    type: "date", 
                                    required: true,
                                    value: dateInput,
                                    onChange: (e) => setDateInput(e.target.value),
                                    className: "w-full pl-12 pr-2 py-3 sm:py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:outline-none focus:border-slate-300 focus:ring-0 text-base sm:text-lg font-semibold transition-all text-slate-700 appearance-none"
                                })
                            )
                        ),
                        h("div", { className: "flex-1" },
                            h("label", { className: "block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-1" }, "Peso"),
                            h("div", { className: "relative group" },
                                h("div", { className: `absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 transition-colors ${currentTheme.iconColor}` }, h(Icons.Activity, null)),
                                h("input", { 
                                    type: "number", 
                                    step: "0.1", 
                                    inputMode: "decimal",
                                    required: true,
                                    placeholder: "0.0",
                                    value: weightInput,
                                    onChange: (e) => setWeightInput(e.target.value),
                                    className: "w-full pl-12 pr-4 py-3 sm:py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:outline-none focus:border-slate-300 focus:ring-0 text-base sm:text-lg font-semibold transition-all text-slate-700"
                                })
                            )
                        )
                    ),
                    h("button", { 
                        type: "submit", 
                        disabled: isSubmitting,
                        className: `w-full bg-gradient-to-r ${editingId ? 'from-amber-400 to-orange-500' : currentTheme.gradientBg} text-white font-bold text-lg py-3 sm:py-4 rounded-2xl transition-all shadow-lg transform active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 hover:opacity-90 touch-manipulation`
                    }, saveButtonContent)
                )
            );

            const historyListContent = filteredSortedLogs.length === 0 ? 
                h("div", { className: "text-center py-16 bg-white/60 rounded-3xl border-2 border-dashed border-slate-200 mx-2" },
                    h("p", { className: "text-slate-400 font-medium text-lg" }, "Sin registros"),
                    h("p", { className: "text-slate-400/70" }, "¡Empieza hoy!")
                )
            :
                h("div", { className: "bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden mx-1 sm:mx-0" },
                    h("div", { className: "grid grid-cols-12 bg-slate-50 p-4 border-b border-slate-100 text-xs font-bold text-slate-400 uppercase tracking-wider" },
                        h("div", { className: "col-span-4 pl-1" }, "Fecha"),
                        h("div", { className: "col-span-4 text-center" }, "Peso"),
                        h("div", { className: "col-span-4 text-right pr-2" }, "Var.")
                    ),
                    h("div", { className: "divide-y divide-slate-50" },
                        filteredSortedLogs.map((log, index) => {
                            const diff = getDifference(index, log.weight);
                            const isGain = diff > 0;
                            const isLoss = diff < 0;
                            const isNeutral = diff === 0;
                            const isEditing = editingId === log.id;

                            let variationContent;
                            if (diff !== null) {
                                variationContent = h("div", { className: `flex items-center gap-0.5 sm:gap-1 text-lg sm:text-xl font-black ${isLoss ? 'text-emerald-500' : isGain ? 'text-rose-500' : 'text-slate-300'}` },
                                    isLoss ? h(Icons.TrendingDown, { className: "w-4 h-4 sm:w-6 sm:h-6" }) : null,
                                    isGain ? h(Icons.TrendingUp, { className: "w-4 h-4 sm:w-6 sm:h-6" }) : null,
                                    isNeutral ? h(Icons.Minus, { className: "w-4 h-4 sm:w-5 sm:h-5" }) : null,
                                    h("span", { className: "hidden sm:inline" }, Math.abs(diff).toFixed(1)),
                                    h("span", { className: "sm:hidden text-base" }, Math.abs(diff).toFixed(1))
                                );
                            } else {
                                variationContent = h("span", { className: "text-slate-300 font-bold text-xl" }, "-");
                            }

                            return h("div", { 
                                key: log.id,
                                className: `grid grid-cols-12 items-center p-4 sm:p-5 transition-colors relative ${isEditing ? 'bg-amber-50' : 'hover:bg-slate-50'}`
                            },
                                h("div", { className: "col-span-4 text-slate-500 font-semibold text-sm pl-1 leading-tight" }, formatDate(log.date)),
                                h("div", { className: "col-span-4 text-center" },
                                    h("span", { className: `text-2xl sm:text-3xl font-black tracking-tight ${isEditing ? 'text-amber-600' : 'text-slate-700'}` }, log.weight)
                                ),
                                h("div", { className: "col-span-4 flex justify-end items-center gap-1 sm:gap-2 pr-1" },
                                    variationContent,
                                    h("div", { className: "flex gap-0 sm:gap-1 ml-1 sm:ml-2" },
                                        h("button", { 
                                            onClick: () => startEditing(log),
                                            className: `p-2 rounded-full transition-colors active:scale-90 ${isEditing ? 'bg-amber-200 text-amber-700' : 'text-slate-300 hover:text-blue-500 hover:bg-blue-50'}`,
                                            title: "Editar"
                                        }, h(Icons.Edit2, { className: "w-4 h-4 sm:w-5 sm:h-5" })),
                                        h("button", { 
                                            onClick: (e) => { e.stopPropagation(); confirmDelete(log.id); },
                                            className: "p-2 text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-full transition-colors active:scale-90",
                                            title: "Eliminar"
                                        }, h(Icons.Trash2, { className: "w-4 h-4 sm:w-5 sm:h-5" }))
                                    )
                                )
                            );
                        })
                    )
                );

            const renderHistory = h("div", { className: "w-full max-w-lg pb-10" },
                h("h2", { className: "text-xl font-black text-slate-700 mb-4 px-4 flex items-center gap-2" },
                    h(Icons.TrendingUp, { className: `w-6 h-6 ${currentTheme.iconColor}` }),
                    "Historial"
                ),
                historyListContent
            );

            return h("div", { className: `min-h-screen font-sans text-slate-800 flex flex-col items-center py-6 px-4 transition-colors duration-500 ${currentTheme.bgPage}` },
                renderErrorBanner,
                renderModal,
                renderHeader,
                renderProfileSelector,
                renderForm,
                renderHistory
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(h(App));
    </script>
</body>
</html>
